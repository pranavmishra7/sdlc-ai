<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>SDLC AI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      max-width: 900px;
    }
    textarea {
      width: 100%;
      height: 80px;
    }
    button {
      padding: 8px 14px;
      margin-top: 10px;
    }
    .step {
      padding: 6px;
      margin: 4px 0;
      border-radius: 4px;
    }
    .pending { background: #eee; }
    .running { background: #fff3cd; }
    .completed { background: #d4edda; }
    .failed { background: #f8d7da; }
    pre {
      background: #111;
      color: #0f0;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

<h1>SDLC AI</h1>

<h3>Product Idea</h3>
<textarea id="idea"></textarea>
<br />
<button onclick="startJob()">Start Job</button>

<h3>Status</h3>
<div id="status"></div>

<h3>Steps</h3>
<div id="steps"></div>

<h3>Actions</h3>
<button onclick="resumeJob()">Resume Job</button>

<h3>Result</h3>
<pre id="result"></pre>

<script>
let jobId = null;
let poller = null;

function startJob() {
  const idea = document.getElementById("idea").value;
  fetch(`/v1/start?product_idea=${encodeURIComponent(idea)}`, {
    method: "POST"
  })
    .then(r => r.json())
    .then(data => {
      jobId = data.job_id;
      document.getElementById("status").innerText = "Job started: " + jobId;
      startPolling();
    });
}

function startPolling() {
  if (poller) clearInterval(poller);
  poller = setInterval(fetchStatus, 2000);
}

function fetchStatus() {
  if (!jobId) return;

  fetch(`/v1/status/${jobId}`)
    .then(r => r.json())
    .then(data => {
      document.getElementById("status").innerText =
        `Status: ${data.status} | Current step: ${data.current_step}`;

      const stepsDiv = document.getElementById("steps");
      stepsDiv.innerHTML = "";

      for (const [step, state] of Object.entries(data.steps)) {
        const div = document.createElement("div");
        div.className = `step ${state}`;
        div.innerText = `${step}: ${state}`;
        stepsDiv.appendChild(div);
      }

      if (data.status === "completed") {
        clearInterval(poller);
        fetchResult();
      }
    });
}

function fetchResult() {
  fetch(`/v1/result/${jobId}`)
    .then(r => r.json())
    .then(data => {
      document.getElementById("result").innerText =
        JSON.stringify(data, null, 2);
    });
}

function resumeJob() {
  if (!jobId) return;

  fetch(`/v1/resume/${jobId}`, { method: "POST" })
    .then(r => r.json())
    .then(() => startPolling());
}
</script>

</body>
</html>
